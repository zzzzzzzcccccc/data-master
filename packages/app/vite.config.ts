import { defineConfig, loadEnv } from 'vite'
import legacyPlugin from '@vitejs/plugin-legacy'
import * as path from 'path'
import { htmlSlotPlugin } from '../../vite-plugins'
import { APP_NAME } from '@dm/core'

const svgInjectorCode = `window._iconfont_svg_string_4485013='<svg><symbol id="icon-jiancha" viewBox="0 0 1024 1024"><path d="M737.9 385.4c0 7-2.8 13.6-7.7 18.6-4.9 4.9-11.6 7.7-18.6 7.7H300.1c-9.4 0-18-5-22.7-13.1-4.7-8.1-4.7-18.1 0-26.2 4.7-8.1 13.4-13.1 22.7-13.1h411.6c14.5-0.2 26.2 11.6 26.2 26.1zM479.1 707.8c0 13.6-11 24.5-24.5 24.5H298.3c-8.7 0-16.8-4.7-21.2-12.2-4.4-7.6-4.4-16.9 0-24.5 4.4-7.6 12.5-12.2 21.2-12.2h156.3c13.5-0.1 24.5 10.8 24.5 24.4zM611.4 543.4c0 14.2-11.5 25.6-25.7 25.6H299.5c-14.2 0-25.7-11.5-25.7-25.7s11.5-25.7 25.7-25.7h286.3c14.2 0.1 25.6 11.6 25.6 25.8zM792.2 604h-53.6v-53.6c0-13.5-10.9-24.5-24.5-24.5-13.5 0-24.5 11-24.5 24.5V604h-53.7c-13.5 0-24.5 11-24.5 24.5s11 24.5 24.5 24.5h53.7v53.6c0.3 13.3 11.2 23.9 24.5 23.9s24.2-10.6 24.5-23.9V653h53.7c13.5 0 24.5-11 24.5-24.5-0.1-13.6-11.1-24.5-24.6-24.5z"  ></path><path d="M768.1 111.3H645.8v-2.9c0.3-12.5-6.2-24.1-17-30.4-10.7-6.3-24.1-6.3-34.8 0-10.7 6.3-17.2 17.9-17 30.4v2.9H434.8v-2.9c0.4-12.5-6.1-24.2-16.9-30.6-10.8-6.4-24.2-6.4-35 0s-17.3 18.1-16.9 30.6v2.9H258.9c-106.5 0-193.1 86.5-193.1 192.8V758c0 106.3 86.6 192.8 193.1 192.8h509.2c106.5 0 193.1-86.5 193.2-192.8V304.2c-0.1-106.4-86.7-192.9-193.2-192.9z m137.2 646.8c0 75.4-61.5 136.8-137.2 136.8H258.9c-75.6 0-137.2-61.4-137.2-136.8V304.2c0-75.5 61.5-136.9 137.2-136.9H366v2.9c0.5 18.6 15.8 33.4 34.4 33.4s33.9-14.8 34.4-33.4v-2.9H577v2.9c-0.2 12.5 6.2 24.1 17 30.4 10.7 6.3 24.1 6.3 34.8 0 10.7-6.3 17.2-17.9 17-30.4v-2.9H768c75.7 0 137.2 61.4 137.2 136.9v453.9z"  ></path></symbol><symbol id="icon-waijian" viewBox="0 0 1024 1024"><path d="M375.4752 0a34.1504 34.1504 0 0 1 33.5872 28.0064l0.5376 6.144V204.8h273.0752a170.6752 170.6752 0 0 1 170.3168 159.4624l0.3328 11.2128v170.6496h136.5248a34.1248 34.1248 0 0 1 33.5872 28.0064l0.5632 6.144v409.6a34.1504 34.1504 0 0 1-28.0064 33.5872l-6.144 0.5632H648.5248a34.1504 34.1504 0 0 1-33.5872-28.0064l-0.5376-6.144V819.2H341.3248a170.6752 170.6752 0 0 1-170.3168-159.4624l-0.3328-11.2128v-170.6496H34.1504a34.1248 34.1248 0 0 1-33.5872-28.0064L0 443.7248v-409.6A34.0992 34.0992 0 0 1 28.0064 0.5376l6.144-0.5632h341.3248z m580.2496 614.4H682.6752v341.3248h273.0496V614.4zM409.6 443.7248a34.1504 34.1504 0 0 1-27.9808 33.5872l-6.144 0.5632H238.9248v170.6496a102.4 102.4 0 0 0 92.5696 101.9136l9.8304 0.4864H614.4v-170.6496a34.1248 34.1248 0 0 1 27.9808-33.5872l6.144-0.5632h136.5504v-170.6496a102.4 102.4 0 0 0-92.5952-101.9392l-9.8048-0.4608H409.6v170.6496zM341.3248 68.2752H68.2752V409.6h273.0496V68.2752z m0 0"  ></path></symbol><symbol id="icon-index" viewBox="0 0 1024 1024"><path d="M843.5 737.4c-12.4-75.2-79.2-129.1-155.3-125.4S550.9 676 546 752c-153.5-4.8-208-40.7-199.1-113.7 3.3-27.3 19.8-41.9 50.1-49 18.4-4.3 38.8-4.9 57.3-3.2 1.7 0.2 3.5 0.3 5.2 0.5 11.3 2.7 22.8 5 34.3 6.8 34.1 5.6 68.8 8.4 101.8 6.6 92.8-5 156-45.9 159.2-132.7 3.1-84.1-54.7-143.7-147.9-183.6-29.9-12.8-61.6-22.7-93.3-30.2-14.3-3.4-26.3-5.7-35.2-7.2-7.9-75.9-71.5-133.8-147.8-134.4-76.3-0.6-140.9 56.1-150.1 131.9s40 146.3 114.2 163.9c74.2 17.6 149.9-23.3 175.7-95.1 9.4 1.7 18.7 3.6 28 5.8 28.2 6.6 56.4 15.4 82.4 26.6 70.7 30.2 109.3 70.1 107.5 119.9-1.6 44.6-33.6 65.2-96.2 68.6-27.5 1.5-57.6-0.9-87.3-5.8-8.3-1.4-15.9-2.8-22.6-4.3-3.9-0.8-6.6-1.5-7.8-1.8l-3.1-0.6c-2.2-0.3-5.9-0.8-10.7-1.3-25-2.3-52.1-1.5-78.5 4.6-55.2 12.9-93.9 47.2-101.1 105.8-15.7 126.2 78.6 184.7 276 188.9 29.1 70.4 106.4 107.9 179.6 87 73.3-20.9 119.3-93.4 106.9-168.6zM329.1 345.2c-46 0-83.3-37.3-83.3-83.3s37.3-83.3 83.3-83.3 83.3 37.3 83.3 83.3-37.3 83.3-83.3 83.3zM695.6 845c-46 0-83.3-37.3-83.3-83.3s37.3-83.3 83.3-83.3 83.3 37.3 83.3 83.3-37.3 83.3-83.3 83.3z"  ></path></symbol><symbol id="icon-db_field" viewBox="0 0 1024 1024"><path d="M800 896h-576A96 96 0 0 1 128 799.36v-576A96 96 0 0 1 224 128h576A96 96 0 0 1 896 224.64v576A96 96 0 0 1 800 896z m-576-704a32 32 0 0 0-32 32v576a32 32 0 0 0 32 32h576a32 32 0 0 0 32-32v-576a32 32 0 0 0-32-32z"  ></path><path d="M848 414.72H176a32 32 0 0 1-32-32 32 32 0 0 1 32-32h672a32 32 0 0 1 32 32 32 32 0 0 1-32 32z"  ></path><path d="M398.08 880a32 32 0 0 1-32-32V392.32a32 32 0 0 1 32-32 32 32 0 0 1 32 32v455.68a32 32 0 0 1-32 32z"  ></path></symbol><symbol id="icon-sql-query" viewBox="0 0 1024 1024"><path d="M397.897 538.88c-6.034-10.789-14.628-21.76-25.783-33.097-3.291-3.474-10.24-9.692-20.845-18.469-8.96-7.314-15.726-13.714-20.115-19.2-11.885-14.263-17.737-28.16-17.737-41.874 0-8.777 1.829-16.091 5.303-21.943 4.389-7.314 10.606-10.971 18.834-10.971 7.863 0 13.715 2.56 17.92 7.497 5.669 6.948 9.326 16.457 10.606 28.708l43.337-7.862c-1.097-13.166-4.388-24.686-9.874-34.743-5.486-10.057-12.8-17.92-21.577-23.406-11.52-7.131-25.235-10.789-41.326-10.789-16.823 0-30.72 4.206-42.057 12.618-18.286 14.08-27.429 34.742-27.429 61.988 0 15.177 3.292 29.257 10.057 42.24 6.218 11.52 16.823 24.503 31.818 39.132 17.92 17.005 31.268 29.622 40.228 38.034 11.337 12.251 17.006 24.686 17.006 37.12 0 8.594-1.463 15.177-4.572 19.931-5.851 9.326-13.714 14.263-23.771 14.629-6.949 0.366-13.166-2.56-18.651-8.412-7.315-7.862-11.886-20.48-13.898-38.034l-43.154 3.109c0.914 15.908 4.206 30.171 9.874 42.423 5.669 12.434 13.349 22.125 23.04 29.257 11.703 8.777 26.332 13.165 44.069 13.165 9.509 0 17.92-1.097 25.051-3.291 13.349-4.206 23.772-11.154 31.086-21.211 11.154-14.812 16.64-32.732 16.274-53.578-0.182-8.411-2.377-18.102-6.765-28.708-1.829-4.572-4.206-9.143-6.949-14.263z m193.829 49.189V424.41c0-19.565-6.949-36.571-20.846-50.651a68.79 68.79 0 0 0-50.651-21.211c-19.749 0-36.755 6.948-50.835 21.028-14.08 13.897-21.028 30.903-21.028 50.834V588.07c0 19.748 6.948 36.754 21.028 50.834 13.897 14.08 30.903 21.028 50.835 21.028 11.885 0 22.674-2.742 32.731-8.228 8.229 14.263 23.771 21.394 46.446 21.394V631.04c-7.497 0-13.166-2.377-17.189-6.949 6.217-10.971 9.509-23.04 9.509-36.022z m-46.995-0.366c0 7.131-2.56 13.348-7.68 18.286-5.12 4.937-11.337 7.497-18.468 7.497s-13.349-2.56-18.286-7.497a25.417 25.417 0 0 1-7.497-18.286V423.497c0-7.131 2.56-13.348 7.497-18.286 4.937-5.12 11.154-7.497 18.286-7.497s13.348 2.56 18.468 7.497c5.12 4.938 7.68 11.155 7.68 18.286v164.206zM690.834 356.57H645.67v299.703h123.245v-44.983h-78.08z"  ></path><path d="M853.577 801.829c-1.828-1.829-3.657-3.292-5.851-4.755C915.566 717.531 952.503 617.691 952.503 512c0-242.834-197.669-440.503-440.503-440.503S71.497 269.166 71.497 512 269.166 952.503 512 952.503c105.691 0 205.531-37.12 285.074-104.777 1.28 2.011 2.926 4.023 4.755 5.851l88.32 88.32c7.131 7.132 16.457 10.789 25.782 10.789s18.652-3.657 25.783-10.789c14.263-14.263 14.263-37.486 0-51.748l-88.137-88.32zM512 879.36c-202.606 0-367.36-164.754-367.36-367.36S309.394 144.64 512 144.64 879.36 309.394 879.36 512c0 98.194-38.217 190.354-107.52 259.84S610.194 879.36 512 879.36z"  ></path></symbol><symbol id="icon-table-info" viewBox="0 0 1024 1024"><path d="M85.333 170.667h853.334v170.666H85.333z"  ></path><path d="M85.333 384h256v128h-256zM384 384h256v128H384z m298.667 0h256v128h-256zM85.333 725.333h256v128h-256z m298.667 0h256v128H384z m298.667 0h256v128h-256z"  ></path><path d="M85.333 554.667h256v128h-256z m298.667 0h256v128H384z m298.667 0h256v128h-256z"  ></path></symbol><symbol id="icon-save" viewBox="0 0 1041 1024"><path d="M958.801433 35.397414a26.027511 26.027511 0 1 1 35.7618 37.826649L361.105681 672.065025a26.027511 26.027511 0 0 0-8.155286 18.913325v296.019553a26.027511 26.027511 0 1 1-52.055022 0v-296.019553a78.082532 78.082532 0 0 1 24.448509-56.739973L958.801433 35.380063z"  ></path><path d="M65.537272 361.60888L263.901605 559.93851a26.027511 26.027511 0 0 1-36.8029 36.820252L18.791863 388.486622a43.379184 43.379184 0 0 1 16.969936-71.835929L970.027966 5.222854a43.379184 43.379184 0 0 1 54.865992 54.883344L713.466119 994.372364a43.379184 43.379184 0 0 1-71.870633 16.90053L443.265856 811.884812a26.027511 26.027511 0 0 1 36.924362-36.716142l188.352418 189.393519L970.027966 60.106198 65.537272 361.591528z"  ></path></symbol><symbol id="icon-system" viewBox="0 0 1024 1024"><path d="M794.876114 623.329575c-4.783956-4.061502-7.258311-6.379291-9.951653-8.400321-27.737738-20.753673-37.71395-44.189432-32.31908-82.143858 19.799952-139.245368-93.01751-253.946736-206.836789-266.310322-143.582139-15.60235-261.73205 74.765821-279.95918 212.771965-21.769816 164.801417 123.728976 302.652018 287.364847 271.409456 18.377556-3.505847 30.783097 0.446162 42.819225 13.751189 8.514931 9.429767 19.276019 16.845667 32.580023 28.195156-37.47245 19.61678-38.010709 50.350758-36.038798 81.839937 1.935072 31.033807-3.793396 60.916395-34.653241 73.42529-33.675984 13.660114-71.837118 16.503882-103.297644-3.982708-14.459317-9.42158-21.934568-32.737612-27.67327-51.281967-4.351098-14.047947-0.679475-30.500665-1.039679-45.880957-0.559748-24.533766-11.769045-42.688241-34.498722-52.258201-22.688745-9.547447-43.470047-5.464455-61.298088 11.907191-11.017938 10.737552-21.74321 21.793352-33.060977 32.196283-21.935592 20.160155-52.573379 26.043143-75.032904 9.692756-19.629059-14.298658-37.691437-32.264844-52.094472-51.806923-15.779382-21.428032-9.508561-54.511521 9.918907-75.270311 10.469446-11.20418 22.021549-21.402449 32.740682-32.383548 15.635095-16.001439 21.249977-35.371602 14.46034-56.601112-7.082302-22.11774-23.340591-35.936467-46.434565-38.980803-17.726733-2.337231-35.800367-1.866511-53.721529-2.759857-38.677904-1.922792-61.155848-24.400736-62.807465-63.172785-0.514723-11.9471-0.478907-23.938202-0.044002-35.885302 1.438769-39.9642 26.599821-64.673975 66.683748-65.559135 14.517645-0.320295 29.096688 0.571005 43.574425-0.286526 24.105001-1.416256 42.938951-12.609179 51.909254-35.371602 8.921183-22.632463 3.952009-43.584658-13.619182-61.065797-9.673313-9.634428-19.343557-19.290345-28.817326-29.135574-4.100388-4.272303-8.376785-8.619308-11.404748-13.637602-21.141506-35.013445-8.628518-69.843718 38.730093-108.711957 27.560706-22.61916 61.065797-21.494547 87.968517 3.302209 11.302417 10.416234 21.803585 21.712511 33.151028 32.078603 18.178011 16.623609 39.643905 20.278859 61.772902 10.707876 21.187555-9.166777 33.17968-26.012444 32.980135-50.296523-0.132006-16.217357-0.211824-32.505321 0.964978-48.667419 2.278903-31.390941 22.608927-55.883775 53.201689-60.253292 20.027126-2.861164 41.111327-2.827395 61.155848-0.034792 28.816303 4.00829 49.54644 29.52443 51.111075 59.169611 0.913812 17.046235-0.776689 34.263361 0.605797 51.252291 1.938142 23.699772 12.786211 41.890063 36.236296 51.210335 23.64656 9.387811 43.388183 3.282766 60.841693-13.609972 7.360641-7.132444 14.276145-14.739702 21.528316-21.985734 4.825912-4.825912 9.550517-9.873882 14.94027-14.026458 34.249035-26.360368 72.396867-15.230889 113.570615 32.894178 25.098631 29.332049 23.430642 64.166415-4.146437 91.538833-10.901281 10.821463-22.363334 21.295002-31.896454 33.258475-14.863523 18.651802-19.837814 40.295751-8.697079 62.270229 10.434653 20.570501 28.559453 31.032784 52.106752 31.026644 14.532995-0.011256 29.083385-0.51984 43.577494 0.177032 34.573423 1.673106 59.320037 22.192442 63.605643 55.234999 2.39556 18.451234 2.410909 37.747719-0.078795 56.18258-4.431939 32.807197-30.226418 54.028521-63.679321 55.307653-10.245342 0.396019-20.565385 0.74906-30.763654-0.056282C834.505693 592.222089 812.48312 600.493473 794.876114 623.329575L794.876114 623.329575 794.876114 623.329575zM336.428797 465.277886c21.129226 22.157649 41.911552 44.651966 63.458287 66.385966 41.071418 41.432645 94.473675 42.723034 134.031623 3.771907 40.815591-40.181141 40.192398-92.732008-2.596128-135.203308-21.810748-21.63781-45.025473-41.848107-65.680908-66.107627 55.258535-16.457834 105.312534-7.430226 150.141532 23.8942 71.059406 49.65491 97.591689 133.460618 68.603471 215.108173-5.52176 15.544021-0.925069 23.334451 8.909927 32.962739 53.104475 51.995211 106.144482 104.066147 158.685115 156.632363 30.141484 30.17116 28.558429 66.269309-2.89698 93.571119-25.332968 21.975501-56.918337 21.159926-82.621742-3.979638-53.156664-51.972699-105.923448-104.357789-158.085458-157.321048-12.117992-12.295024-21.593807-15.470343-39.461757-9.457396-69.969585 23.548322-133.780913 9.17394-187.102329-41.697681-50.094932-47.783283-65.217351-107.36938-53.014424-174.025499C331.347059 468.304825 333.893045 466.791355 336.428797 465.277886L336.428797 465.277886 336.428797 465.277886zM809.286312 777.423115c-17.692964 2.096754-29.640064 11.273764-31.242562 30.090319-1.462305 17.126053 14.383592 32.659841 31.79003 32.692586 17.664312 0.029676 32.298614-14.899338 31.289634-32.889061C840.03871 787.971355 828.319807 779.017426 809.286312 777.423115L809.286312 777.423115 809.286312 777.423115zM809.286312 777.423115"  ></path></symbol><symbol id="icon-Settings" viewBox="0 0 1024 1024"><path d="M512 697.856C409.6 697.856 326.144 614.4 326.144 512S409.6 326.144 512 326.144 697.856 409.6 697.856 512 614.4 697.856 512 697.856z m0-283.648c-53.76 0-97.28 44.032-97.28 97.792 0 53.76 43.52 97.792 97.28 97.792s97.792-44.032 97.792-97.792c0-53.76-44.032-97.792-97.792-97.792z"  ></path><path d="M591.872 998.4H432.128a44.032 44.032 0 0 1-44.032-44.032v-45.056c0-16.384-9.728-30.72-24.576-37.376a40.2944 40.2944 0 0 0-43.52 8.704l-29.696 29.696c-16.384 16.384-46.08 16.384-62.464 0l-112.64-113.152a43.8784 43.8784 0 0 1 0-62.464l29.696-29.696c11.776-11.776 14.848-28.672 8.704-44.032a40.6528 40.6528 0 0 0-36.864-25.088h-45.568a44.032 44.032 0 0 1-44.032-44.032V432.64c0-24.576 19.968-44.032 44.032-44.032h45.056c16.384 0 30.72-9.728 36.864-24.576s2.56-32.256-8.704-44.032l-29.696-29.696a43.8784 43.8784 0 0 1 0-62.464l112.64-113.152c16.384-16.384 45.568-16.384 62.464 0l29.696 29.696c11.776 11.776 29.184 15.36 44.032 9.216 15.36-6.144 25.088-20.992 25.088-37.376v-46.592c0-24.576 19.968-44.032 44.032-44.032h159.744c24.576 0 44.032 19.968 44.032 44.032v46.592c0 16.384 9.728 30.72 24.576 36.864s32.256 2.56 43.52-8.704l29.696-30.208c16.384-16.384 46.08-16.384 62.464 0l112.64 113.152c17.408 17.408 17.408 45.056 0 62.464l-29.696 29.696c-11.264 11.776-14.848 28.672-8.704 44.032 6.144 15.36 20.992 25.088 36.864 25.088h45.056c24.576 0 44.032 19.968 44.032 44.032v159.744c0 24.576-19.968 44.032-44.032 44.032h-45.056c-16.384 0-30.72 9.728-36.864 25.088-6.144 14.848-2.56 32.256 8.704 43.52l29.696 30.208c17.408 17.408 17.408 45.056 0 62.464l-112.64 113.152c-8.192 8.192-19.456 12.8-31.232 12.8-11.776 0-23.04-4.608-31.232-12.8l-29.696-29.696a40.448 40.448 0 0 0-43.52-8.704c-15.36 6.144-25.088 20.992-25.088 37.376v45.056c0 23.552-19.968 43.52-44.032 43.52zM476.16 910.336l71.168-1.024c0-52.224 31.232-98.816 79.36-118.784 46.08-19.456 101.888-8.704 138.24 26.624l50.688-50.688c-35.84-36.864-46.08-91.136-26.624-138.752 19.968-48.128 66.56-79.36 118.272-79.36h1.024l-1.024-71.68c-52.224 0-98.304-31.232-118.272-79.36-19.968-47.616-9.216-101.888 26.624-138.752l-50.688-50.688c-35.84 35.328-91.648 46.08-138.752 26.624a126.9248 126.9248 0 0 1-78.336-118.272v-2.56H476.16v2.56c0 52.224-31.232 98.816-79.36 118.784-46.08 19.456-102.4 8.704-138.24-26.624l-50.176 50.688c35.84 36.864 46.08 91.136 26.624 138.752-19.968 48.128-66.56 79.36-118.784 79.36h-1.024l1.024 71.68c52.224 0 98.816 31.232 118.272 79.36 19.456 47.616 9.216 101.888-26.624 138.752l50.688 50.688c36.352-35.328 92.16-45.568 138.752-26.624 48.128 19.968 78.848 66.56 78.848 118.784v0.512z"  ></path></symbol><symbol id="icon-iconconnection" viewBox="0 0 1229 1024"><path d="M789.9648 341.3504v85.2992h-263.3216c-49.408 0.9216-90.7776 17.5616-124.1088 50.0224-33.3824 32.4608-50.5344 72.704-51.456 120.6784V768c0.9216 48.0256 18.0736 88.2176 51.456 120.6784 33.3312 32.4096 74.752 49.1008 124.1088 49.9712h438.8352c49.3568-0.8704 90.7264-17.5616 124.1088-49.9712 33.3824-32.4608 50.5344-72.704 51.456-120.6784v-170.6496c0-31.1296-7.7824-59.5968-23.3472-85.3504a178.944 178.944 0 0 0-64.4608-62.6688V355.9936c52.1216 18.688 94.208 49.3568 126.208 92.0064 32 42.6496 48.4352 92.4672 49.3568 149.3504V768c-1.8432 72.9088-27.4432 133.3248-76.8 181.3504-49.3568 47.9744-111.5648 72.8576-186.5216 74.6496h-438.8352c-75.008-1.792-137.1648-26.624-186.5216-74.6496S265.1648 840.9088 263.3216 768v-170.6496c1.8432-72.9088 27.4432-133.3248 76.8-181.3504 49.3568-48.0256 111.5136-72.9088 186.5216-74.6496h263.3216zM438.784 682.6496v-85.2992h263.3216c49.408-0.9216 90.7776-17.5616 124.1088-50.0224 33.3824-32.4608 50.5344-72.704 51.456-120.6784V256c-0.9216-48.0256-18.0736-88.2176-51.456-120.6784-33.3312-32.4096-74.752-49.1008-124.1088-49.9712H263.3216c-49.3568 0.8704-90.7264 17.5616-124.1088 49.9712-33.3824 32.4608-50.5344 72.704-51.456 120.6784v170.6496c0 31.1296 7.7824 59.5968 23.3472 85.3504 15.5136 25.7536 37.0176 46.6432 64.4608 62.6688v93.3376c-53.0432-18.688-95.3344-49.7664-126.8736-93.3376A253.5424 253.5424 0 0 1 0 426.7008V256c1.8432-72.9088 27.4432-133.3248 76.8-181.3504C126.1568 26.6752 188.3648 1.792 263.3216 0h438.8352c75.008 1.792 137.1648 26.624 186.5216 74.6496s74.9568 108.4416 76.8 181.3504v170.6496c-1.8432 72.9088-27.4432 133.3248-76.8 181.3504-49.3568 48.0256-111.5136 72.9088-186.5216 74.6496H438.8352z"  ></path></symbol><symbol id="icon-plus-square" viewBox="0 0 1024 1024"><path d="M85.312 85.312v853.376h853.376V85.312H85.312zM0 0h1024v1024H0V0z m554.624 213.312v256h256v85.376h-256v256H469.312v-256h-256V469.376h256v-256h85.312z"  ></path></symbol><symbol id="icon-mysql" viewBox="0 0 1024 1024"><path d="M1001.632 793.792c-7.84-13.856-26.016-37.536-93.12-83.2a1096.224 1096.224 0 0 0-125.152-74.144c-30.592-82.784-89.824-190.112-176.256-319.36-93.056-139.168-201.12-197.792-321.888-174.56a756.608 756.608 0 0 0-40.928-37.696C213.824 78.688 139.2 56.48 96.32 60.736c-19.424 1.952-34.016 9.056-43.36 21.088-21.664 27.904-14.432 68.064 85.504 198.912 19.008 55.616 23.072 84.672 23.072 99.296 0 30.912 15.968 66.368 49.984 110.752l-32 109.504c-28.544 97.792 23.328 224.288 71.616 268.384 25.76 23.552 47.456 20.032 58.176 15.84 21.504-8.448 38.848-29.472 50.048-89.504a4390.107 4390.107 0 0 1 18.208 45.6c34.56 87.744 68.352 136.288 106.336 152.736a32.032 32.032 0 0 0 25.44-58.688c-9.408-4.096-35.328-23.712-72.288-117.504-31.168-79.136-53.856-132.064-69.376-161.856a32.224 32.224 0 0 0-35.328-16.48 32.032 32.032 0 0 0-25.024 29.92c-3.872 91.04-13.056 130.4-19.2 147.008C261.632 785.28 220 689.76 240.896 618.208c20.768-71.232 32.992-112.928 36.64-125.248a31.936 31.936 0 0 0-5.888-29.28c-41.664-51.168-46.176-75.584-46.176-83.712 0-29.472-9.248-70.4-28.288-125.152a31.104 31.104 0 0 0-4.768-8.896c-53.824-70.112-73.6-105.216-80.832-121.888 25.632 1.216 74.336 15.04 91.008 29.376a660.8 660.8 0 0 1 49.024 46.304 31.902 31.902 0 0 0 31.232 8.928c100.192-25.92 188.928 21.152 271.072 144 87.808 131.328 146.144 238.048 173.408 317.216a32 32 0 0 0 16.384 18.432 1004.544 1004.544 0 0 1 128.8 75.264 944.85 944.85 0 0 1 20.064 14.016h-98.848a32.032 32.032 0 0 0-24.352 52.736 3098.752 3098.752 0 0 0 97.856 110.464 32 32 0 1 0 46.56-43.872 2237.6 2237.6 0 0 1-50.08-55.328h110.08a32.032 32.032 0 0 0 27.84-47.776zM320 289.472c12.672 21.76 22.464 37.344 29.344 46.784 8.288 16.256 21.184 29.248 29.44 45.536l2.016-1.984c14.528-9.952 25.92-49.504 2.752-75.488-12.032-18.176-51.04-17.664-63.552-14.848z"  ></path></symbol><symbol id="icon-pgsql" viewBox="0 0 1024 1024"><path d="M407.8763 91.024C160.4803 13.174 18.9923 84.024 29.0403 292.5c1.078 20.04 8.262 61.602 20.686 113.198 12.426 51.59 29.902 112.162 51.396 166.556 21.49 54.388 46.304 102.35 77.252 130.336 15.474 13.992 33.826 23.434 53.98 22.64 20.154-0.798 39.326-11.768 56.566-31.048 41.13-46.034 74.854-79.236 81.456-85.702 17.774 8.896 35.124 14.496 59.73 14.744-21.286 25.718-24.676 34.106-59.918 38.922-38.822 5.306-75.662 18.614-55.964 50.804 14.148 23.122 119.788 47.03 180.92-7.126 1.12 161.428-4.454 293.424 151.92 269.722 127.138-19.27 119.592-103.576 142.868-280.72 117.526 22.492 236.352-51.39 196.204-86.35-20.54-19.388-90.56 20.524-143.51-4.53 83.75-105.694 186.286-371.956 127.348-456.974-83.848-97.136-219.892-121.7-360.42-79.884-89.596-19-153.13-6.57-201.68 23.934z m251.452-8.094c157.504-30.934 308.776 39.836 300.282 140.69-11.3 134.162-64.442 248.192-134.144 354.454-1.7-1.946-3.41-3.796-5.172-5.82 41.944-72.114 16.664-119.6 15.516-180.786-0.56-29.772 13.82-93.802 8.968-106.768-25.686-68.672-58.792-144.222-185.45-201.77z m-124.44 2.918c150.652 4.712 234.65 92.66 277.334 192.1-107.716-9.362-139.404 40.166-119.268 115.134 14.288 46.61 36.338 90.27 62.06 129.688 14.806 21.66 10.732 29.812 51.394 77.94-36.35 9.604-44.066 34.344-43.644 65.646-1.874 23.24-17.872 148.73-25.86 191.78-12.036 68.874-49.748 81.636-96 90.556-120.286 17.37-115.646-62.34-115.404-294.288-2.498-32.928-33.018-57.824-64.636-51.746 16.54-69.8 76.202-118.35 39.434-262.278-19.912-73.02-98.352-70.51-171.96-34.28 13.556-135.952 77.438-221.244 206.55-220.252zM294.4023 463.59c-7.79 51.816 14.052 99.878 51.07 129.364-19.392 21.07-51.376 49.656-65.368 68.16-55.248 73.072-90.86 35.054-151.188-98.566C65.5303 362.984 17.8203 228.224 104.0263 132.422c67.204-60.644 167.272-51.442 277.324-21.024-27.6 25.126-46.104 56.1-58.504 86.672-43.232 117.22-14.388 174.94-28.444 265.52z m507.156 83.436c-30.36-52.314-71.234-123.548-79.84-160.41-15.096-59.368 1.598-90.808 94.386-80.528-0.552 27.108-8.498 49.386-9.698 84.41-0.206 51.168 20.384 115.544-4.848 156.528zM431.7803 595.534c-64.18-0.096-118.804-58.06-108.284-128.068 6.408-40.552 6.134-83.334 2.908-127.1 47.244-31.804 134.492-53.51 145.134 5.828 34.16 144.98-14.886 160.552-39.758 249.34z m356.844-270.686c-1.786-13.772-51.564-7.302-49.778 6.468 4.232 14.604 34.414 24.354 49.232-2.758 0.516-0.948 0.648-2.712 0.546-3.71zM454.4003 347.168c19.466-21.264-47.856-32.47-51.394-13.26-2.12 11.106 27.118 37.886 51.394 13.26z m501.006 285.24c-52.846 45.154-138.206 44.682-162.904 33.306 0.252-20.396-0.534-35.496 31.03-40.744 24.002 16.982 66.296 20.27 131.874 7.44z m-613.814 65.976c10.834-6.9 47.384-10.204 70.02-20.114 18.156-7.946 29.006-24.536 46.22-42.704 16.27-20.054 47.524 8.686 35.032 31.124-43.758 58.532-122.046 47.442-151.272 31.694zM21.6883 412.488C-67.0837 82.33 127.7403-20.506 404.1483 62.448c55.056-30.294 124.144-38.438 207.756-23.66 147.744-40.616 300.108-12.266 387.066 100.14 47.644 78.524 0.666 275.512-107.684 446.634 74.02-3.326 77.086-22.48 113.44 1.946 71.126 66.588-68.464 150.642-192.848 139.368-0.856 4.126-1.568 8.758-2.268 13.938-2.776 96.134-17.054 155.38-48.294 196.738-31.574 41.8-78.994 55.108-116.356 62.552-151.984 22.23-172.998-96.848-173.726-246.974-66.032 28.41-153.956 8.84-178.91-22.04-52.856 38.502-100.138 21.384-133.86-7.78-62.126-59.084-98.434-165.104-136.776-310.822z"  ></path></symbol><symbol id="icon-mingliangmoshi" viewBox="0 0 1024 1024"><path d="M885.033492 861.876576l-24.384363 24.385387c-0.301875 0.301875-0.791016 0.301875-1.091868 0l-99.314936-99.314936c-0.301875-0.301875-0.301875-0.791016 0-1.091868l24.384363-24.384363c0.301875-0.301875 0.791016-0.301875 1.091868 0l99.314936 99.314936C885.335367 861.086583 885.335367 861.575724 885.033492 861.876576z"  ></path><path d="M786.745954 265.285992l-24.385387-24.385387c-0.301875-0.301875-0.301875-0.791016 0-1.091868l99.314936-99.314936c0.301875-0.301875 0.791016-0.301875 1.091868 0l24.384363 24.385387c0.301875 0.301875 0.301875 0.791016 0 1.091868l-99.314936 99.314936C787.535947 265.586844 787.046807 265.586844 786.745954 265.285992z"  ></path><path d="M163.649694 888.38123l-24.385387-24.384363c-0.301875-0.301875-0.301875-0.791016 0-1.091868l99.314936-99.314936c0.301875-0.301875 0.791016-0.301875 1.091868 0l24.385387 24.385387c0.301875 0.301875 0.301875 0.791016 0 1.091868l-99.314936 99.314936C164.440709 888.682082 163.951569 888.682082 163.649694 888.38123z"  ></path><path d="M528.332487 1019.906775l-34.484396 0c-0.426719 0-0.772596-0.345877-0.772596-0.772596L493.075495 878.68131c0-0.426719 0.345877-0.772596 0.772596-0.772596l34.484396 0c0.426719 0 0.772596 0.345877 0.772596 0.772596l0 140.453892C529.10406 1019.561921 528.759206 1019.906775 528.332487 1019.906775z"  ></path><path d="M526.21322 150.96427l-34.484396 0c-0.426719 0-0.772596-0.345877-0.772596-0.772596L490.956228 9.739828c0-0.426719 0.345877-0.772596 0.772596-0.772596l34.484396 0c0.426719 0 0.772596 0.345877 0.772596 0.772596L526.985816 150.193721C526.985816 150.619416 526.639938 150.96427 526.21322 150.96427z"  ></path><path d="M2.441105 528.499789l0-34.484396c0-0.426719 0.345877-0.772596 0.772596-0.772596l140.453892 0c0.426719 0 0.772596 0.345877 0.772596 0.772596l0 34.484396c0 0.426719-0.345877 0.772596-0.772596 0.772596L3.213701 529.272385C2.786983 529.272385 2.441105 528.926508 2.441105 528.499789z"  ></path><path d="M881.979946 528.499789l0-34.484396c0-0.426719 0.345877-0.772596 0.772596-0.772596l140.453892 0c0.426719 0 0.772596 0.345877 0.772596 0.772596l0 34.484396c0 0.426719-0.345877 0.772596-0.772596 0.772596L882.752542 529.272385C882.325823 529.272385 881.979946 528.926508 881.979946 528.499789z"  ></path><path d="M265.117666 241.960751l-24.385387 24.385387c-0.301875 0.301875-0.791016 0.301875-1.091868 0l-99.314936-99.314936c-0.301875-0.301875-0.301875-0.791016 0-1.091868l24.385387-24.385387c0.301875-0.301875 0.791016-0.301875 1.091868 0l99.314936 99.314936C265.419542 241.170758 265.419542 241.659899 265.117666 241.960751z"  ></path><path d="M507.911388 216.665645c-160.360268 0-290.353924 129.99775-290.353924 290.353924 0 160.358221 129.993656 290.353924 290.353924 290.353924 160.356175 0 290.353924-129.995703 290.353924-290.353924C798.266336 346.663394 668.267563 216.665645 507.911388 216.665645zM507.911388 748.627279c-133.437082 0-241.608733-108.171652-241.608733-241.608733S374.474307 265.410835 507.911388 265.410835c133.435035 0 241.608733 108.171652 241.608733 241.608733S641.347447 748.627279 507.911388 748.627279z"  ></path></symbol><symbol id="icon-heianmoshi" viewBox="0 0 1024 1024"><path d="M179.285333 721.578667a390.570667 390.570667 0 0 0 326.4 174.506666c214.912 0 389.162667-171.733333 389.162667-383.573333 0-187.989333-137.301333-344.704-318.848-377.344 10.666667 39.253333 16.170667 80.085333 16.170667 121.6 0 237.994667-179.882667 434.517333-412.885334 464.810667z m-69.333333-81.237334h6.570667c214.912 0 389.12-171.690667 389.12-383.573333 0-53.504-11.093333-105.386667-32.298667-153.344L446.421333 42.666667l67.242667 1.109333C772.992 48 981.333333 256.554667 981.333333 512.512 981.333333 771.456 768.384 981.333333 505.685333 981.333333c-190.890667 0-361.002667-111.872-436.053333-281.344L42.666667 639.232l67.285333 1.109333z"  ></path></symbol></svg>',function(a){var c=(c=document.getElementsByTagName("script"))[c.length-1],t=c.getAttribute("data-injectcss"),c=c.getAttribute("data-disable-injectsvg");if(!c){var h,l,e,o,i,n=function(c,t){t.parentNode.insertBefore(c,t)};if(t&&!a.__iconfont__svg__cssinject__){a.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(c){console&&console.log(c)}}h=function(){var c,t=document.createElement("div");t.innerHTML=a._iconfont_svg_string_4485013,(t=t.getElementsByTagName("svg")[0])&&(t.setAttribute("aria-hidden","true"),t.style.position="absolute",t.style.width=0,t.style.height=0,t.style.overflow="hidden",t=t,(c=document.body).firstChild?n(t,c.firstChild):c.appendChild(t))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(h,0):(l=function(){document.removeEventListener("DOMContentLoaded",l,!1),h()},document.addEventListener("DOMContentLoaded",l,!1)):document.attachEvent&&(e=h,o=a.document,i=!1,v(),o.onreadystatechange=function(){"complete"==o.readyState&&(o.onreadystatechange=null,s())})}function s(){i||(i=!0,e())}function v(){try{o.documentElement.doScroll("left")}catch(c){return void setTimeout(v,50)}s()}}(window);`

export default defineConfig((config) => {
  const envDir = './env'
  const isDevelopment = config.mode === 'development'
  const wdyr = path.resolve(
    __dirname,
    isDevelopment
      ? 'node_modules/@welldone-software/why-did-you-render'
      : 'src/__mocks__/@welldone-software/why-did-you-render/index.ts',
  )
  const reduxLogger = path.resolve(
    __dirname,
    isDevelopment ? 'node_modules/redux-logger' : 'src/__mocks__/redux-logger/index.ts',
  )
  const envString = JSON.stringify({ config, env: loadEnv(config.mode, envDir) })
  const splitBundleRules = {
    react: 'r-vendor',
    antd: 'a-vendor',
    'monaco-editor': 'me-vendor',
  }

  return {
    base: './',
    envDir,
    server: {
      port: 3333,
    },
    resolve: {
      alias: {
        '@welldone-software/why-did-you-render': wdyr,
        'redux-logger': reduxLogger,
      },
    },
    build: {
      sourcemap: isDevelopment,
      rollupOptions: {
        output: {
          manualChunks: (path) => {
            if (path.includes('node_modules')) {
              const keys = Object.keys(splitBundleRules)
              const findIndex = keys.findIndex((name) => path.includes(name))
              if (findIndex > -1) {
                const name = keys[findIndex] as keyof typeof splitBundleRules
                return splitBundleRules[name]
              }
              return 'vendor'
            }
          },
        },
      },
    },
    plugins: [
      htmlSlotPlugin({
        slot: `<!--APP_VARS-->`,
        content: `<input aria-hidden="true" id="app_env_vars" type="hidden" value="${encodeURIComponent(envString)}" />`,
      }),
      htmlSlotPlugin({
        slot: `<!--APP_NAME-->`,
        content: `<title>${APP_NAME}</title>`,
      }),
      htmlSlotPlugin({
        slot: `<!--SVG_SPRITE-->`,
        content: `<script>${svgInjectorCode}</script>`,
      }),
      legacyPlugin({
        targets: ['> 0.5%', 'ie >= 11'],
      }),
    ],
  }
})
